<DOCTYPE html>
<html>
<head>
  <title>Upload Rooms to Google Cloud Endpoints</title>
  <meta charset="utf-8"> 
</head>
<body>
  
<script src="/bower_components/d3/d3.js" charset="utf-8"></script>
<script src="/js/housing.js" charset="utf-8"></script>
<script src="/js/auth.js" charset="utf-8"></script>
<script src="/js/client.js" charset="utf-8"></script>
<script>
// Google API callbacks don't work with namespaces
function gapiCallback() {
    housing.auth.init();
}

housing.app = function(authenticated){
  if(authenticated) {
    d3.json("/spec.json",function(err,jsonobj){
      if(jsonobj){
        var i = 0;
        for(j in jsonobj.floors){
          var f = jsonobj.floors[j];
          for(k in f.rooms){
            var r = f.rooms[k];
            gapi.client.housing.housing.createRoom({
              "number": r.number,
              "x": r.x,
              "y": r.y,
              "capacity": r.capacity,
              "floor":f.number
            }).then(function(resp){
              d3.select("body")
                .append("pre")
                  .text(resp.body);
              gapi.client.housing.housing.updateRoom({"number":r.number}).execute();
            },function(resp){
              d3.select("body")
                .append("pre")
                  .text(resp.body);
            });
            i++;
            //if(i > 5){
              //return;
            //}
          }
        }
      }
    });
  } else {
    d3.select("body")
      .append("a")
        .classed("button", true)
        .text("Sign In")
        .on("click",housing.auth.click);
  }
};

</script>
<script src="https://apis.google.com/js/client.js?onload=gapiCallback"></script>
</body>
</html>
