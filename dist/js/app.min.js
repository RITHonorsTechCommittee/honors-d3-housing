var housing=housing||{};housing.app=function(a){var b=d3.select("#floornav .floors");if(a){b.html(null);var c=d3.select("#selection").html(null).append("svg").attr("width",768).attr("height",609);housing.client.load(c,b,"4b")}else b.html(null),b.append("a").classed("button",!0).text("Sign In").on("click",housing.auth.click)};var housing=housing||{};housing.auth=housing.auth||{},housing.auth.clientId="180343920180-41f9qsqdcf9it1poolqtqages644lgs3.apps.googleusercontent.com",housing.auth.scopes="https://www.googleapis.com/auth/userinfo.email",housing.auth.init=function(){var a,b=function(){0==--a&&housing.auth.check()};a=2,gapi.client.load("housing","v1",b,"https://rithonorshousing.appspot.com/_ah/api"),gapi.client.load("oauth2","v2",b)},housing.auth.check=function(){gapi.auth.authorize({client_id:housing.auth.clientId,scope:housing.auth.scopes,immediate:!0},housing.auth.result)},housing.auth.result=function(a){housing.app&&housing.app(a&&!a.error)},housing.auth.click=function(){return gapi.auth.authorize({client_id:housing.auth.clientId,scope:housing.auth.scopes,immediate:!1},housing.auth.result),!1};var housing=housing||{};housing.client=housing.client||{},housing.client.load=function(a,b,c){gapi.client.housing?gapi.client.housing.housing.rooms().then(function(d){var e=d.result.floors;housing.init(a,b,e),housing.load(e,c,a)},function(){}):d3.json("/spec.json",function(d,e){e&&(housing.init(a,b,e.floors),housing.load(e.floors,c,a))})};var housing=housing||{};housing.init=function(a,b,c,d){"undefined"==typeof d&&(d=!1),d&&(housing.tooltip=d3.tip().attr("class","tooltip").html(housing.style.tooltip),a.call(housing.tooltip)),b&&c&&c.length&&(b.selectAll("li").remove(),b.selectAll("li").data(c).enter().append("li").append("a").attr("href","#").attr("name",function(a){return"floor"+a.number}).classed("button",!0).classed("disabled",!0).text(function(a){return"Floor "+a.number}).on("click",function(b){housing.load(c,b.number,a),d3.event.preventDefault()}))},housing.load=function(a,b,c){d3.selectAll("a.disabled").classed("disabled",!1),d3.select("#floornav").select("ul").selectAll("li").select("[name=floor"+b+"]").classed("disabled",!0),housing.currentFloor=b,housing.currentData=a;var d=c.selectAll("image");d.data(a).attr("visibility",housing.style.imgvisibility).enter().append("image").attr("x",0).attr("y",0).attr("width",768).attr("height",609).attr("xlink:href",housing.style.imghref).attr("visibility",housing.style.imgvisibility),c.selectAll(".circle").remove();for(var e=0;e<a.length;e+=1)if(a[e].number==b){var f=c.selectAll(".circle").data(a[e].rooms),g=f.enter().append("g").attr("transform",housing.style.transform).attr("class","circle").on("click",function(d,e){for(var f=0;f<a.length;f+=1)a[f].number==b&&(a[f].rooms[e].occupants=d.occupants+1,housing.load(a,b,c))});housing.tooltip&&g.on("mouseover",housing.tooltip.show).on("mouseout",housing.tooltip.hide),g.append("circle").attr("r",housing.style.r).attr("fill",housing.style.color.empty).attr("stroke","black");var h=d3.svg.arc().innerRadius(0).outerRadius(housing.style.r).startAngle(0).endAngle(housing.style.endAngle);g.append("path").attr("d",h).attr("fill",housing.style.color.partial),g.append("text").text(housing.style.title).attr("text-anchor","middle").attr("dy",housing.style.titleOffset)}},housing.style={transform:function(a){return"translate("+a.x+" "+a.y+")"},x:function(a){return a.x},y:function(a){return a.y},color:function(a){return"undefined"==typeof a?housing.style.color:0==a.occupants?housing.style.color.empty:a.occupants==a.capacity?housing.style.color.full:housing.style.color.partial},r:function(a){return 4*Math.sqrt(Math.abs(10.5*a.capacity-1))},endAngle:function(a){return 6.28319*a.occupants/a.capacity},tooltip:function(a){return"<strong>"+a.number+"</strong>"},title:function(a){return a.number},titleOffset:function(a){return housing.style.r(a)+10},imghref:function(a){return"/img/049-"+a.number+".png"},imgvisibility:function(a){return housing.currentFloor==a.number?"visible":"hidden"}},housing.style.color.empty="#00ff00",housing.style.color.partial="#0000ff",housing.style.color.full="#ff0000";