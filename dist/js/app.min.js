var housing=housing||{};housing.app=function(a){var b=d3.select("#floornav");if(a){b.html(null);var c=d3.select("#selection").html(null).append("svg").attr("width",768).attr("height",609);housing.client.load(c,b)}else b.html(null),b.append("a").classed("button",!0).text("Sign In").on("click",housing.auth.click)};var housing=housing||{};housing.auth=housing.auth||{},housing.auth.clientId="180343920180-41f9qsqdcf9it1poolqtqages644lgs3.apps.googleusercontent.com",housing.auth.scopes="https://www.googleapis.com/auth/userinfo.email",housing.auth.hostname="https://rithonorshousing.appspot.com",housing.auth.init=function(){var a,b=function(){0==--a&&housing.auth.check()};a=2,gapi.client.load("housing","v1",b,housing.auth.hostname+"/_ah/api"),gapi.client.load("oauth2","v2",b)},housing.auth.check=function(){gapi.auth.authorize({client_id:housing.auth.clientId,scope:housing.auth.scopes,immediate:!0,hd:"g.rit.edu"},housing.auth.result)},housing.auth.result=function(a){housing.app?housing.app(a&&!a.error):housing.client.displayError("The application code is missing. Please contact the developers"),gapi.client.oauth2.userinfo.get().then(function(a){d3.select(".username").html(null).append("a").on("click",housing.auth.click).attr("title","Click to change accounts").text(a.result.email)},function(a){window.console&&console.log&&console.log(a.result.error),setTimeout(housing.app,0,!1)})},housing.auth.click=function(){return gapi.auth.authorize({client_id:housing.auth.clientId,scope:housing.auth.scopes,immediate:!1,authuser:""},housing.auth.result),!1};var housing=housing||{};housing.client=housing.client||{},housing.client.serverError="A server error has occurred. Please contact the developers of this website and report an error with ",housing.client.unauthorizedError="You are not authorized to register for housing. Please check that you are logged in with an RIT Google account",housing.client.load=function(a,b,c){window.gapi&&gapi.client.housing&&gapi.client.housing.housing.rooms?gapi.client.housing.housing.rooms().then(function(d){var e=d.result.floors;void 0==c&&(c=e[0].number),housing.init(a,b,e,!0),housing.load(e,c,a)},function(a){var b=a.result.error.code,c=a.result.error.message;500>b?401==b?(housing.client.displayError(housing.client.unauthorizedError,a.result.error),window.setTimeout(housing.app,0,!1)):housing.client.displayError(c,a.result.error):housing.client.displayError(housing.client.serverError+"'rooms()'")}):d3.json("/spec.json",function(d,e){e&&(void 0==c&&(c=e.floors[0].number),housing.init(a,b,e.floors,!0),housing.load(e.floors,c,a))})},housing.client.current=function(){return window.gapi&&gapi.client.housing&&gapi.client.housing.housing.current?gapi.client.housing.housing.current():{then:function(a,b){b({result:{error:{code:600,message:"API Not Available"}}})}}},housing.client.reserve=function(a){return window.gapi&&gapi.client.housing&&gapi.client.housing.housing.reserve?gapi.client.housing.housing.reserve({number:a}):{then:function(a,b){b({result:{error:{code:600,message:"API Not Available"}}})}}},housing.client.deleteReservation=function(){return window.gapi&&gapi.client.housing&&gapi.client.housing.housing.deleteReservation?gapi.client.housing.housing.deleteReservation():{then:function(a,b){b({result:{error:{code:600,message:"API Not Available"}}})}}},housing.client.displayError=function(a,b){a&&($("#loading").hide(),$("#errorModal .message").html(a),$("#errorModal").foundation("reveal","open")),b&&window.console&&console.log&&console.log(b)},housing.client.errorHelper=function(a,b){var c="";401==a.code?(c=housing.client.unauthorizedError,a.message.contains("@")&&(c+="<br><br>"+a.message),window.setTimeout(housing.app,0,!1)):a.code>=500?(c=housing.client.serverError,c+=b?"'"+b+"'":"'generic'"):(window.console&&console.warn&&console.warn("housing.client.unauthorized called with unrecognized error!"),c=a.message),housing.client.displayError(c,a)};var housing=housing||{};housing.init=function(a,b,c,d){if(console.log("Initializing Housing App"),"undefined"==typeof d&&(d=!1),d&&(housing.tooltip=d3.tip().attr("class","d3-tip").html(housing.style.tooltip),a.call(housing.tooltip)),b&&c&&c.length){b.html(null);var e=b.append("ul").classed("floors button-group",!0),f=b.append("ul").classed("button-group round",!0);e.selectAll("li").data(c).enter().append("li").append("a").attr("href","#").attr("name",function(a){return"floor"+a.number}).classed("button",!0).classed("disabled",!0).text(function(a){return"Floor "+a.number}).on("click",function(b){housing.load(c,b.number,a),d3.event.preventDefault()});var g=f.append("li").append("a").classed("button alert",!0).text("Current Reservation: ").append("span").classed("current-reservation",!0),h=f.append("li").append("a").attr("href","#").classed("button alert clear-reservation disabled",!0).text("Clear Reservation").on("click",housing.clearReservation);housing.client.current().then(function(a){h.classed("disabled",!1),g.text(a.result.roomNumber)},function(a){switch(a.result.error.code){case 401:housing.client.errorHelper(a.result.error,"current()");break;case 404:case 600:h.classed("disabled",!0),g.text("None");break;default:housing.client.displayError(housing.client.serverError+"'current()'",a.result.error)}})}},housing.load=function(a,b,c){console.log("Loading Floor "+b),d3.selectAll(".floors .disabled").classed("disabled",!1),d3.select(".floors [name=floor"+b+"]").classed("disabled",!0),housing.d3svg=c,housing.currentFloor=b,housing.currentData=a;var d=c.selectAll("image");d.data(a).attr("visibility",housing.style.imgvisibility).enter().append("image").attr("x",0).attr("y",0).attr("width",768).attr("height",609).attr("xlink:href",housing.style.imghref).attr("visibility",housing.style.imgvisibility),c.selectAll(".circle").remove();for(var e=0;e<a.length;e+=1)if(a[e].number==b){var f=c.selectAll(".circle").data(a[e].rooms),g=f.enter().append("g").attr("transform",housing.style.transform).attr("class","circle").on("click",housing.clickRoom);housing.tooltip&&g.on("mouseover",housing.showTooltip).on("mouseout",housing.tooltip.hide),g.append("path").attr("d",housing.style.bgpath).classed("shading",!0).attr("fill","black").attr("opacity",0),g.append("circle").attr("r",housing.style.r).attr("class",housing.style.color.empty).attr("stroke","black");var h=d3.svg.arc().innerRadius(0).outerRadius(housing.style.r).startAngle(0).endAngle(housing.style.endAngle);g.append("path").attr("d",h).attr("class",housing.style.color),g.append("text").text(housing.style.title).attr("text-anchor","middle").attr("dy",housing.style.titleOffset)}$("#loading").hide()},housing.clickRoom=function(a,b){if(housing.auth&&housing.client)housing.client.reserve(a.number).then(function(b){housing.load(b.result.floors,housing.currentFloor,housing.d3svg),d3.select(".current-reservation").text(a.number),d3.select(".clear-reservation").classed("disabled",!1)},function(a){housing.client.errorHelper(a.result.error,"reserve()")},this),$("#loading").show();else{for(var c=housing.currentData,d=0;d<c.length;d+=1)if(c[d].number==housing.currentFloor){c[d].rooms[b].occupants=a.occupants+1;break}housing.load(c,housing.currentFloor,housing.d3svg)}},housing.clearReservation=function(){d3.select(".clear-reservation").classed("disabled")||(housing.auth&&housing.client?(housing.client.deleteReservation().then(function(a){housing.load(a.result.floors,housing.currentFloor,housing.d3svg),d3.select(".current-reservation").text("None"),d3.select(".clear-reservation").classed("disabled",!0)},function(a){housing.client.errorHelper(a.result.error,"deleteReservation()")},this),$("#loading").show()):alert("API not available")),d3.event.preventDefault()},housing.showTooltip=function(){var a=Array.prototype.slice.call(arguments),b=d3.event.target;a.push(b.parentNode),housing.tooltip.show.apply(this,a)},housing.style={transform:function(a){return"translate("+a.x+" "+a.y+")"},x:function(a){return a.x},y:function(a){return a.y},color:function(a){return"undefined"==typeof a?housing.style.color:0==a.occupants?housing.style.color.empty:a.occupants==a.capacity?housing.style.color.full:housing.style.color.partial},r:function(a){return 4*Math.sqrt(Math.abs(10.5*a.capacity-1))},endAngle:function(a){return 6.28319*a.occupants/a.capacity},tooltip:function(a){return a&&a.occupantNames?a.occupantNames.join("<br>"):null},title:function(a){return a.number},titleOffset:function(a){return housing.style.r(a)+10},imghref:function(a){return"/img/049-"+a.number+".png"},imgvisibility:function(a){return housing.currentFloor==a.number?"visible":"hidden"},bgpath:function(a){return housing.style.paths.hasOwnProperty(a.bgpath)?housing.style.paths[a.bgpath]:a.bgpath},paths:{0:"M26,50 v-75  h-52  v75  Z",1:"M39,43 v-78  h-78  v78  Z",2:"M39,50 v-75  h-78  v75  Z",3:"M52,32 v-58  h-103 v58  Z",4:"M51,63 v-113 h-102 v113 Z",5:"M38,41 v-75  h-76  v75  Z",6:"M26,37 v-75  h-51  v75  Z",7:"M25,37 v-75  h-48  v75  Z",8:"M40,37 v-75  h-80  v75  Z",9:"M48,62 v-58  h51 v-59 h-153 v117 Z",10:"M39,62 v-106 h-78  v106 Z",11:"M51,60 v-110 h-102 v110 Z",12:"M51,31 v-58  h-102 v58  Z",13:"M53,46 v-75  h-105 v75  Z",14:"M26,44 v-75  h-51  v75  Z",15:"M26,38 v-75  h-51  v75  Z",16:"M38,38 v-75  h-76  v75  Z",17:"M26,38 v-75  h-52  v75  Z",18:"M50,60 v-118 h-102 v118 Z",19:"M38,45 v-75  h-76  v75  Z",20:"M52,32 v-60  h-103 v60  Z"}},housing.style.color.empty="color-empty",housing.style.color.partial="color-partial",housing.style.color.full="color-full";