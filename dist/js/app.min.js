var housing=housing||{};housing.admin=housing.admin||{},housing.admin.start=function(a){var b=d3.select("#floornav");if(a){b.html(null);var c=d3.select("#selection").html(null).append("div").classed("row",!0);housing.endpoints.loadAdmin().then(function(a){a=a.sort(housing.admin.style.listSorter),housing.admin.init(c,b,a),housing.admin.load(a)})}else b.html(null),b.append("a").classed("button",!0).text("Sign In").on("click",housing.endpoints.click),b.append("p").text("Note: there is a current bug with Google Sign In and Internet Explorer.  If you are using Internet Explorer and you end up with a blank window after sigining in, close the window and click Sign In again."),$("#loading").hide()},housing.admin.init=function(a,b,c){console.log("Initializing Housing Admin"),housing.admin.mainelement=a,b&&(b.html(null),housing.endpoints.isOpen().then(function(a){{var c=b.append("div").classed("row",!0),d=c.append("div").classed("small-2 columns",!0).append("fieldset").classed("switch round large",!0).attr("tabindex",0);d.append("input").attr("type","checkbox").attr("id","openswitch").attr("checked","checked")}d.append("label").attr("for","openswitch"),housing.admin.isOpen=a.result.isOpen;var e=housing.admin.isOpen?"Open":"Closed";c.append("div").classed("switch-label small-10 columns",!0).attr("id","openswitch-label").html("Housing Form "+e)},function(a){switch(a.result.error.code){case 401:housing.endpoints.errorHelper(a.result.error,"isOpen()");break;case 404:case 600:break;default:housing.endpoints.displayError(housing.endpoints.serverError+"'isOpen()'",a.result.error)}}));var d=a.selectAll("section").data(c);d.exit().remove();var e=d.enter().append("div").classed("small-12 large-6 columns",!0).append("section").classed("list-section",!0),f=e.append("header").classed("list-header",!0);f.append("h1"),f.append("button").classed("tiny round button",!0).on("click",housing.admin.clickAdd).append("i").classed("fi-plus",!0),f.append("button").classed("tiny round alert button",!0).on("click",housing.admin.clickRemove).append("i").classed("fi-x",!0),e.append("div").classed("list-area",!0),d.select("h1").html(housing.admin.style.title)},housing.admin.load=function(a){var b=housing.admin.mainelement.selectAll("section .list-area").data(a).selectAll("span.list-item").data(function(a){return a.strings});b.exit().remove(),b.enter().append("span").classed("label secondary deletable",!0).on("click",housing.admin.clickRemoveIndividual),b.html(housing.admin.style.simple),$("#loading").hide()},housing.admin.clickAdd=function(){},housing.admin.clickRemove=function(){},housing.admin.clickRemoveIndividual=function(){},housing.admin.clickRoom=function(a,b){if(housing.endpoints&&housing.endpoints)housing.endpoints.reserve(a.number).then(function(b){housing.admin.load(b.result.floors,housing.admin.currentFloor,housing.admin.d3svg),d3.select(".current-reservation").text(a.number),d3.select(".clear-reservation").classed("disabled",!1)},function(a){housing.endpoints.errorHelper(a.result.error,"reserve()")},this),$("#loading").show();else{for(var c=housing.admin.currentData,d=0;d<c.length;d+=1)if(c[d].number==housing.admin.currentFloor){c[d].rooms[b].occupants=a.occupants+1;break}housing.admin.load(c,housing.admin.currentFloor,housing.admin.d3svg)}},housing.admin.clearReservation=function(){d3.select(".clear-reservation").classed("disabled")||(housing.endpoints?(housing.endpoints.deleteReservation().then(function(a){housing.admin.currentData=a.result.floors,housing.admin.load(a.result.floors,housing.admin.currentFloor,housing.admin.d3svg),d3.select(".current-reservation").text("None"),d3.select(".clear-reservation").classed("disabled",!0)},function(a){housing.endpoints.errorHelper(a.result.error,"deleteReservation()")},this),$("#loading").show()):alert("API not available")),d3.event.preventDefault()},housing.admin.style={listSorter:function(a,b){var c=["room list","student list","admin list","editor list"].reverse();return a.key&&b.key?c.indexOf(b.key.toLowerCase())-c.indexOf(a.key.toLowerCase()):a.key?1:b.key?-1:0},title:function(a){return a.key},simple:function(a){return a}};var housing=housing||{};housing.endpoints=housing.endpoints||{},housing.endpoints.hostname="https://rithonorshousing.appspot.com",housing.endpoints.clientId="180343920180-41f9qsqdcf9it1poolqtqages644lgs3.apps.googleusercontent.com",housing.endpoints.scopes="https://www.googleapis.com/auth/userinfo.email",housing.endpoints.serverError="A server error has occurred. Please tell the developers of this website that there was a server error in ",housing.endpoints.apiError="A client API error has occurred. Please tell the developers of this website that there was an API error in ",housing.endpoints.unauthorizedError="You are not authorized to register for housing. Please check that you are logged in with an RIT Google account",housing.endpoints.login=function(){return housing.endpoints._apipromises=housing.endpoints._apipromises||[gapi.client.load("housing","v1",null,housing.endpoints.hostname+"/_ah/api"),gapi.client.load("oauth2","v2")],Promise.all(housing.endpoints._apipromises).then(function(){return new Promise(function(a){housing.endpoints.authorize(!0,a)}).then(housing.endpoints.getUserInfo)})},housing.endpoints.authorize=function(a,b){var c={client_id:housing.endpoints.clientId,scope:housing.endpoints.scopes,immediate:a};a?c.hd="g.rit.edu":c.authuser="",gapi.auth.authorize(c,b)},housing.endpoints.getUserInfo=function(){return Promise.resolve(gapi.client.oauth2.userinfo.get()).catch(Promise.resolve).then(function(a){return a.result&&d3.select("#username").html(null).append("a").attr("title","Click to change accounts").text(a.result.email?a.result.email:"Sign In"),a.result&&a.result.email})},housing.endpoints.load=function(){return window.gapi&&gapi.client.housing&&gapi.client.housing.housing.rooms?Promise.resolve(gapi.client.housing.housing.rooms()):new Promise(function(a,b){d3.json("/spec.json",function(c,d){d?a({result:{floors:d.floors}}):b({result:{error:{code:600,message:c}}})})})},housing.endpoints.current=function(){return window.gapi&&gapi.client.housing&&gapi.client.housing.housing.current?Promise.resolve(gapi.client.housing.housing.current()):Promise.reject({result:{error:{code:600,message:"API Not Available"}}})},housing.endpoints.reserve=function(a){return window.gapi&&gapi.client.housing&&gapi.client.housing.housing.reserve?Promise.resolve(gapi.client.housing.housing.reserve({number:a})):Promise.reject({result:{error:{code:600,message:"API Not Available"}}})},housing.endpoints.deleteReservation=function(){return window.gapi&&gapi.client.housing&&gapi.client.housing.housing.deleteReservation?Promise.resolve(gapi.client.housing.housing.deleteReservation()):Promise.reject({result:{error:{code:600,message:"API Not Available"}}})},housing.endpoints.loadAdmin=function(){var a=function(a){if(a.result&&a.result.error&&a.result.error.code){var b=a.result.error.code;if(401==b||404==b)return null}throw a},b=function(a){return a&&a.result?a.result:a},c=function(a){return a.filter(function(a){return void 0!=a})},d=[];return window.gapi&&gapi.client.housing&&(d.push(Promise.resolve(gapi.client.housing.housing.getStudentList()).catch(a).then(b)),d.push(Promise.resolve(gapi.client.housing.housing.getRoomList()).catch(a).then(b)),d.push(Promise.resolve(gapi.client.housing.housing.getAdminList()).catch(a).then(b)),d.push(Promise.resolve(gapi.client.housing.housing.getEditorList()).catch(a).then(b))),Promise.all(d).then(c)},housing.endpoints.isOpen=function(){return window.gapi&&gapi.client.housing&&gapi.client.housing.housing.isOpen?gapi.client.housing.housing.isOpen():Promise.reject({result:{error:{code:600,message:"API Not Available"}}})},housing.endpoints.displayError=function(a,b){a&&($("#loading").hide(),$("#errorModal .message").html(a),$("#errorModal").foundation("reveal","open")),b&&window.console&&console.log&&console.log(b)},housing.endpoints.errorHelper=function(a,b){a.error&&(a=a.error),null==b&&(b=a.source?a.source:"generic");var c="";401==a.code?(c=housing.endpoints.unauthorizedError,a.message.contains("@")&&(c+="<br><br>"+a.message)):600==a.code?c=housing.endpoints.apierror+"'"+b+"'<br><br>"+a.message:a.code>=500?c=housing.endpoints.serverError+"'"+b+"'":(window.console&&console.warn&&console.warn("housing.endpoints.unauthorized called with unrecognized error!"),c=a.message),housing.endpoints.displayError(c,a)};var housing=housing||{};housing.map=housing.map||{},housing.map.start=function(a){var b=d3.select("#floornav");if(a){b.html(null);var c=d3.select("#selection").html(null).append("svg").attr("width",768).attr("height",609);housing.endpoints.load().then(function(a){var d=a.result.floors[0].number;housing.map.init(c,b,a.result.floors,!0),housing.map.load(a.result.floors,d,c)}).catch(function(a){$("#loading").hide(),housing.endpoints.errorHelper(a.result?a.result:a,"housing.map.start")})}else b.html(null),b.append("a").classed("button",!0).text("Sign In").on("click",housing.endpoints.signin),b.append("p").text("Note: there is a current bug with Google Sign In and Internet Explorer.  If you are using Internet Explorer and you end up with a blank window after sigining in, close the window and click Sign In again."),$("#loading").hide()},housing.map.init=function(a,b,c,d){if(console.log("Initializing Housing App"),"undefined"==typeof d&&(d=!1),d&&(housing.map.tooltip=d3.tip().attr("class","d3-tip").html(housing.map.style.tooltip),a.call(housing.map.tooltip)),b&&c&&c.length){b.html(null);var e=b.append("ul").classed("floors button-group",!0),f=b.append("ul").classed("button-group round",!0);e.selectAll("li").data(c).enter().append("li").append("a").attr("href","#").attr("name",function(a){return"floor"+a.number}).classed("button",!0).classed("disabled",!0).text(function(a){return"Floor "+a.number}).on("click",function(b){housing.map.load(c,b.number,a),d3.event.preventDefault()});var g=f.append("li").append("a").classed("button alert",!0).text("Current Reservation: ").append("span").classed("current-reservation",!0),h=f.append("li").append("a").attr("href","#").classed("button alert clear-reservation disabled",!0).text("Clear Reservation").on("click",housing.map.clearReservation);housing.endpoints.current().then(function(a){h.classed("disabled",!1),g.text(a.result.roomNumber)},function(a){switch(a.result.error.code){case 401:housing.endpoints.errorHelper(a.result.error,"current()");break;case 404:case 600:h.classed("disabled",!0),g.text("None");break;default:housing.endpoints.displayError(housing.endpoints.serverError+"'current()'",a.result.error)}})}},housing.map.load=function(a,b,c){console.log("Loading Floor "+b),d3.selectAll(".floors .disabled").classed("disabled",!1),d3.select(".floors [name=floor"+b+"]").classed("disabled",!0),housing.map.d3svg=c,housing.map.currentFloor=b,housing.map.currentData=a;var d=c.selectAll("image");d.data(a).attr("visibility",housing.map.style.imgvisibility).enter().append("image").attr("x",0).attr("y",0).attr("width",768).attr("height",609).attr("xlink:href",housing.map.style.imghref).attr("visibility",housing.map.style.imgvisibility),c.selectAll(".circle").remove();for(var e=0;e<a.length;e+=1)if(a[e].number==b){var f=c.selectAll(".circle").data(a[e].rooms),g=f.enter().append("g").attr("transform",housing.map.style.transform).attr("class","circle").on("click",housing.map.clickRoom);housing.map.tooltip&&g.on("mouseover",housing.map.showTooltip).on("mouseout",housing.map.tooltip.hide),g.append("path").attr("d",housing.map.style.bgpath).classed("shading",!0).attr("fill","black").attr("opacity",0),g.append("circle").attr("r",housing.map.style.r).attr("class",housing.map.style.color.empty).attr("stroke","black");var h=d3.svg.arc().innerRadius(0).outerRadius(housing.map.style.r).startAngle(0).endAngle(housing.map.style.endAngle);g.append("path").attr("d",h).attr("class",housing.map.style.color),g.append("text").text(housing.map.style.title).attr("text-anchor","middle").attr("dy",housing.map.style.titleOffset)}$("#loading").hide()},housing.map.clickRoom=function(a,b){if(housing.endpoints&&housing.endpoints)housing.endpoints.reserve(a.number).then(function(b){housing.map.load(b.result.floors,housing.map.currentFloor,housing.map.d3svg),d3.select(".current-reservation").text(a.number),d3.select(".clear-reservation").classed("disabled",!1)},function(a){housing.endpoints.errorHelper(a.result.error,"reserve()")},this),$("#loading").show();else{for(var c=housing.map.currentData,d=0;d<c.length;d+=1)if(c[d].number==housing.map.currentFloor){c[d].rooms[b].occupants=a.occupants+1;break}housing.map.load(c,housing.map.currentFloor,housing.map.d3svg)}},housing.map.clearReservation=function(){d3.select(".clear-reservation").classed("disabled")||($("#loading").show(),housing.endpoints.deleteReservation().then(function(a){housing.map.currentData=a.result.floors,housing.map.load(a.result.floors,housing.map.currentFloor,housing.map.d3svg),d3.select(".current-reservation").text("None"),d3.select(".clear-reservation").classed("disabled",!0)}).catch(function(a){housing.endpoints.errorHelper(a.result?a.result:a,"deleteReservation()")}).then(function(){$("#loading").hide()})),d3.event.preventDefault()},housing.map.showTooltip=function(){var a=Array.prototype.slice.call(arguments),b=d3.event.target;a.push(b.parentNode),housing.map.tooltip.show.apply(this,a)},housing.map.style={transform:function(a){return"translate("+a.x+" "+a.y+")"},x:function(a){return a.x},y:function(a){return a.y},color:function(a){return"undefined"==typeof a?housing.map.style.color:0==a.occupants?housing.map.style.color.empty:a.occupants==a.capacity?housing.map.style.color.full:housing.map.style.color.partial},r:function(a){return 4*Math.sqrt(Math.abs(10.5*a.capacity-1))},endAngle:function(a){return 6.28319*a.occupants/a.capacity},tooltip:function(a){return a&&a.occupantNames?a.occupantNames.join("<br>"):null},title:function(a){return a.number},titleOffset:function(a){return housing.map.style.r(a)+10},imghref:function(a){return"/img/049-"+a.number+".png"},imgvisibility:function(a){return housing.map.currentFloor==a.number?"visible":"hidden"},bgpath:function(a){return housing.map.style.paths.hasOwnProperty(a.bgpath)?housing.map.style.paths[a.bgpath]:a.bgpath},paths:{0:"M26,50 v-75  h-52  v75  Z",1:"M39,43 v-78  h-78  v78  Z",2:"M39,50 v-75  h-78  v75  Z",3:"M52,32 v-58  h-103 v58  Z",4:"M51,63 v-113 h-102 v113 Z",5:"M38,41 v-75  h-76  v75  Z",6:"M26,37 v-75  h-51  v75  Z",7:"M25,37 v-75  h-48  v75  Z",8:"M40,37 v-75  h-80  v75  Z",9:"M48,62 v-58  h51 v-59 h-153 v117 Z",10:"M39,62 v-106 h-78  v106 Z",11:"M51,60 v-110 h-102 v110 Z",12:"M51,31 v-58  h-102 v58  Z",13:"M53,46 v-75  h-105 v75  Z",14:"M26,44 v-75  h-51  v75  Z",15:"M26,38 v-75  h-51  v75  Z",16:"M38,38 v-75  h-76  v75  Z",17:"M26,38 v-75  h-52  v75  Z",18:"M50,60 v-118 h-102 v118 Z",19:"M38,45 v-75  h-76  v75  Z",20:"M52,32 v-60  h-103 v60  Z"}},housing.map.style.color.empty="color-empty",housing.map.style.color.partial="color-partial",housing.map.style.color.full="color-full";