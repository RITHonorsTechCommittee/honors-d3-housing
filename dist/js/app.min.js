var housing=housing||{};housing.app=function(a){var b=d3.select("#floornav");if(a){b.html(null);var c=d3.select("#selection").html(null).append("svg").attr("width",768).attr("height",609);housing.client.load(c,b,"4b")}else b.html(null),b.append("a").classed("button",!0).text("Sign In").on("click",housing.auth.click)};var housing=housing||{};housing.auth=housing.auth||{},housing.auth.clientId="180343920180-41f9qsqdcf9it1poolqtqages644lgs3.apps.googleusercontent.com",housing.auth.scopes="https://www.googleapis.com/auth/userinfo.email",housing.auth.init=function(){var a,b=function(){0==--a&&housing.auth.check()};a=2,gapi.client.load("housing","v1",b,"https://rithonorshousing.appspot.com/_ah/api"),gapi.client.load("oauth2","v2",b)},housing.auth.check=function(){gapi.auth.authorize({client_id:housing.auth.clientId,scope:housing.auth.scopes,immediate:!0},housing.auth.result)},housing.auth.result=function(a){housing.app&&housing.app(a&&!a.error)},housing.auth.click=function(){return gapi.auth.authorize({client_id:housing.auth.clientId,scope:housing.auth.scopes,immediate:!1},housing.auth.result),!1};var housing=housing||{};housing.client=housing.client||{},housing.client.load=function(a,b,c){window.gapi&&gapi.client&&gapi.client.housing?gapi.client.housing.housing.rooms().then(function(d){var e=d.result.floors;housing.init(a,b,e),housing.load(e,c,a)},function(a){console.log(a)}):d3.json("/spec.json",function(d,e){e&&(housing.init(a,b,e.floors,!1),housing.load(e.floors,c,a))})},housing.client.current=function(){return{then:function(a,b){b({result:{error:"Not Implemented"}})}}};var housing=housing||{};housing.init=function(a,b,c,d){if(console.log("Initializing Housing App"),"undefined"==typeof d&&(d=!1),d&&(housing.tooltip=d3.tip().attr("class","tooltip").html(housing.style.tooltip),a.call(housing.tooltip)),b&&c&&c.length){b.html(null);var e=b.append("ul").classed("floors button-group",!0),f=b.append("ul").classed("button-group round",!0);e.selectAll("li").data(c).enter().append("li").append("a").attr("href","#").attr("name",function(a){return"floor"+a.number}).classed("button",!0).classed("disabled",!0).text(function(a){return"Floor "+a.number}).on("click",function(b){housing.load(c,b.number,a),d3.event.preventDefault()});var g=f.append("li").append("a").classed("button alert disabled",!0).text("Current Reservation: ").append("span").classed("current-reservation",!0),h=f.append("li").append("a").attr("href","#").classed("button alert disabled clear-reservation",!0).text("Clear Reservation").on("click",housing.clearReservation);housing.client.current().then(function(a){h.classed("disabled",!1),g.text(a.result.roomNumber)},function(){g.text("None")})}},housing.load=function(a,b,c){console.log("Loading Floor "+b),d3.selectAll("a.disabled").classed("disabled",!1),d3.select(".floors [name=floor"+b+"]").classed("disabled",!0),housing.currentFloor=b,housing.currentData=a;var d=c.selectAll("image");d.data(a).attr("visibility",housing.style.imgvisibility).enter().append("image").attr("x",0).attr("y",0).attr("width",768).attr("height",609).attr("xlink:href",housing.style.imghref).attr("visibility",housing.style.imgvisibility),c.selectAll(".circle").remove();for(var e=0;e<a.length;e+=1)if(a[e].number==b){var f=c.selectAll(".circle").data(a[e].rooms),g=f.enter().append("g").attr("transform",housing.style.transform).attr("class","circle").on("click",housing.clickRoom);housing.tooltip&&g.on("mouseover",housing.tooltip.show).on("mouseout",housing.tooltip.hide),g.append("path").attr("d",housing.style.bgpath).classed("shading",!0).attr("fill","black").attr("opacity",0),g.append("circle").attr("r",housing.style.r).attr("class",housing.style.color.empty).attr("stroke","black");var h=d3.svg.arc().innerRadius(0).outerRadius(housing.style.r).startAngle(0).endAngle(housing.style.endAngle);g.append("path").attr("d",h).attr("class",housing.style.color),g.append("text").text(housing.style.title).attr("text-anchor","middle").attr("dy",housing.style.titleOffset)}},housing.clickRoom=function(a){for(var b=0;b<data.length;b+=1)data[b].number==floor&&(data[b].rooms[j].occupants=a.occupants+1,housing.load(data,floor,d3svg))},housing.clearReservation=function(){d3.select(".clear-reservation").classed("disabled")||alert("Not implemented"),d3.event.preventDefault()},housing.style={transform:function(a){return"translate("+a.x+" "+a.y+")"},x:function(a){return a.x},y:function(a){return a.y},color:function(a){return"undefined"==typeof a?housing.style.color:0==a.occupants?housing.style.color.empty:a.occupants==a.capacity?housing.style.color.full:housing.style.color.partial},r:function(a){return 4*Math.sqrt(Math.abs(10.5*a.capacity-1))},endAngle:function(a){return 6.28319*a.occupants/a.capacity},tooltip:function(a){return"<strong>"+a.number+"</strong>"},title:function(a){return a.number},titleOffset:function(a){return housing.style.r(a)+10},imghref:function(a){return"/img/049-"+a.number+".png"},imgvisibility:function(a){return housing.currentFloor==a.number?"visible":"hidden"},bgpath:function(a){switch(a.bgpath){case 0:return"M26,50 v-75  h-52  v75  Z";case 1:return"M39,43 v-78  h-78  v78  Z";case 2:return"M39,50 v-75  h-78  v75  Z";case 3:return"M52,32 v-58  h-103 v58  Z";case 4:return"M51,63 v-113 h-102 v113 Z";case 5:return"M38,41 v-75  h-76  v75  Z";case 6:return"M26,37 v-75  h-51  v75  Z";case 7:return"M25,37 v-75  h-48  v75  Z";case 8:return"M40,37 v-75  h-80  v75  Z";case 9:return"M48,62 v-58  h51 v-59 h-153 v117 Z";case 10:return"M39,62 v-106 h-78  v106 Z";case 11:return"M51,60 v-110 h-102 v110 Z";case 12:return"M51,31 v-58  h-102 v58  Z";case 13:return"M53,46 v-75  h-105 v75  Z";case 14:return"M26,44 v-75  h-51  v75  Z";case 15:return"M26,38 v-75  h-51  v75  Z";case 16:return"M38,38 v-75  h-76  v75  Z";case 17:return"M26,38 v-75  h-52  v75  Z";case 18:return"M50,60 v-118 h-102 v118 Z";case 19:return"M38,45 v-75  h-76  v75  Z";case 20:return"M52,32 v-60  h-103 v60  Z";default:return}}},housing.style.color.empty="color-empty",housing.style.color.partial="color-partial",housing.style.color.full="color-full";